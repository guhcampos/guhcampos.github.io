<script src="https://open.spotify.com/embed/iframe-api/v1" async></script>

{{ $playlists := where .Site.RegularPages "Section" "playlists" }}
{{ $playlists_data := .Site.Data.playlists }}

<div class="space-y-8">
    <section class="w-full grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {{/* Pin 'This is Guhcampos' first if it exists */}}
        {{ $pinned_id := "this-is-guhcampos" }}
        {{ $pinned := where $playlists "Params.playlist_id" $pinned_id | first 1 }}
        {{ with index $pinned 0 }}
            {{ $playlist_id := .Params.playlist_id }}
            {{ if and $playlist_id (index $playlists_data $playlist_id) }}
                {{ $playlist_data := index $playlists_data $playlist_id }}
                {{ $total_duration := 0 }}
                {{ range $playlist_data.tracks }}
                    {{ $total_duration = add $total_duration .duration_ms }}
                {{ end }}
                {{ $duration_minutes := div $total_duration 60000 | int }}
                <article class="border border-neutral-200 dark:border-neutral-700 border-2 rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-300">
                    <div class="p-6">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-neutral-800 dark:text-neutral-200 mb-2">
                                    <a href="{{ .RelPermalink }}" class="decoration-primary-500 hover:underline hover:underline-offset-2">
                                        {{ $playlist_data.name | emojify }}
                                    </a>
                                </h3>
                                {{ if $playlist_data.description }}
                                <p class="text-sm text-neutral-600 dark:text-neutral-400 line-clamp-2">
                                    {{ $playlist_data.description }}
                                </p>
                                {{ end }}
                            </div>
                            <div class="flex-shrink-0 ml-4">
                                <div class="w-16 h-16 bg-gradient-to-br from-primary-500 to-secondary-500 rounded-lg flex items-center justify-center">
                                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M18 3a1 1 0 00-1.196-.98l-10 2A1 1 0 006 5v9.114A4.369 4.369 0 005 14c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V7.82l8-1.6v5.894A4.369 4.369 0 0015 12c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V3z"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between text-sm text-neutral-500 dark:text-neutral-400 mb-4">
                            <div class="flex items-center space-x-4">
                                <span class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    {{ len $playlist_data.tracks }} {{ i18n "playlists.tracks" | default "tracks" }}
                                </span>
                                <span class="flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                                    </svg>
                                    {{ $duration_minutes }} {{ i18n "playlists.minutes" | default "min" }}
                                </span>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <a href="{{ .RelPermalink }}" class="flex-1 bg-primary-500 hover:bg-primary-600 text-white text-center py-2 px-4 rounded-md transition-colors duration-200 text-sm font-medium">
                                {{ i18n "playlists.view" | default "View Playlist" }}
                            </a>
                            <div class="relative group">
                                <button class="bg-neutral-100 dark:bg-neutral-700 hover:bg-neutral-200 dark:hover:bg-neutral-600 text-neutral-700 dark:text-neutral-300 p-2 rounded-md transition-colors duration-200">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                                    </svg>
                                </button>
                                <div class="absolute right-0 mt-2 w-48 bg-white dark:bg-neutral-800 rounded-md shadow-lg border border-neutral-200 dark:border-neutral-700 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10">
                                    <div class="py-1">
                                        <a href="/static/playlists/{{ $playlist_id }}.json" download class="block px-4 py-2 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-700">
                                            {{ i18n "playlists.download_json" | default "Download JSON" }}
                                        </a>
                                        <a href="/static/playlists/{{ $playlist_id }}.m3u" download class="block px-4 py-2 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-700">
                                            {{ i18n "playlists.download_m3u" | default "Download M3U" }}
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </article>
            {{ end }}
        {{ end }}

        {{/* Render all other playlists sorted by name, skipping the pinned one */}}
        {{ $sorted := sort $playlists "Title" }}
        {{ range $sorted }}
            {{ if ne .Params.playlist_id $pinned_id }}
                {{ $playlist_id := .Params.playlist_id }}
                {{ if and $playlist_id (index $playlists_data $playlist_id) }}
                    {{ $playlist_data := index $playlists_data $playlist_id }}
                    {{ $total_duration := 0 }}
                    {{ range $playlist_data.tracks }}
                        {{ $total_duration = add $total_duration .duration_ms }}
                    {{ end }}
                    {{ $duration_minutes := div $total_duration 60000 | int }}
                    <article class="border border-neutral-200 dark:border-neutral-700 border-2 rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-300">
                        <div class="p-6">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex-1">
                                    <h3 class="text-xl font-bold text-neutral-800 dark:text-neutral-200 mb-2">
                                        <a href="{{ .RelPermalink }}" class="decoration-primary-500 hover:underline hover:underline-offset-2">
                                            {{ $playlist_data.name | emojify }}
                                        </a>
                                    </h3>
                                    {{ if $playlist_data.description }}
                                    <p class="text-sm text-neutral-600 dark:text-neutral-400 line-clamp-2">
                                        {{ $playlist_data.description }}
                                    </p>
                                    {{ end }}
                                </div>
                                <div class="flex-shrink-0 ml-4">
                                    <div class="w-16 h-16 bg-gradient-to-br from-primary-500 to-secondary-500 rounded-lg flex items-center justify-center">
                                        <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M18 3a1 1 0 00-1.196-.98l-10 2A1 1 0 006 5v9.114A4.369 4.369 0 005 14c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V7.82l8-1.6v5.894A4.369 4.369 0 0015 12c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V3z"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between text-sm text-neutral-500 dark:text-neutral-400 mb-4">
                                <div class="flex items-center space-x-4">
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                        {{ len $playlist_data.tracks }} {{ i18n "playlists.tracks" | default "tracks" }}
                                    </span>
                                    <span class="flex items-center">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                                        </svg>
                                        {{ $duration_minutes }} {{ i18n "playlists.minutes" | default "min" }}
                                    </span>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <a href="{{ .RelPermalink }}" class="flex-1 bg-primary-500 hover:bg-primary-600 text-white text-center py-2 px-4 rounded-md transition-colors duration-200 text-sm font-medium">
                                    {{ i18n "playlists.view" | default "View Playlist" }}
                                </a>
                                <div class="relative group">
                                    <button class="bg-neutral-100 dark:bg-neutral-700 hover:bg-neutral-200 dark:hover:bg-neutral-600 text-neutral-700 dark:text-neutral-300 p-2 rounded-md transition-colors duration-200">
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                                        </svg>
                                    </button>
                                    <div class="absolute right-0 mt-2 w-48 bg-white dark:bg-neutral-800 rounded-md shadow-lg border border-neutral-200 dark:border-neutral-700 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10">
                                        <div class="py-1">
                                            <a href="/static/playlists/{{ $playlist_id }}.json" download class="block px-4 py-2 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-700">
                                                {{ i18n "playlists.download_json" | default "Download JSON" }}
                                            </a>
                                            <a href="/static/playlists/{{ $playlist_id }}.m3u" download class="block px-4 py-2 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-700">
                                                {{ i18n "playlists.download_m3u" | default "Download M3U" }}
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </article>
                {{ end }}
            {{ end }}
        {{ end }}
    </section>
</div>

