{{ $playlist_id := .Get "playlist_id" }}
{{ $playlist_data := index .Site.Data.playlists $playlist_id }}

{{ if $playlist_data }}
{{ $total_duration := 0 }}
{{ range $playlist_data.tracks }}
    {{ $total_duration = add $total_duration .duration_ms }}
{{ end }}
{{ $duration_minutes := div $total_duration 60000 | int }}





<div class="space-y-6 from-primary-500 to-secondary-500 rounded-lg p-6 text-white" data-playlist-id="{{ $playlist_data.id }}" >


    <div class="flex items-center space-x-8 text-sm">
        <span class="flex items-center">
            <svg class="w-5 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" clip-rule="evenodd"/>
            </svg>
            <span>{{ len $playlist_data.tracks }} {{ i18n "playlists.tracks" | default "tracks" }}</span>
        </span>
        <span class="flex items-center ml-2">
            <svg class="w-5 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
            </svg>
            <span>{{ $duration_minutes }} {{ i18n "playlists.minutes" | default "minutes" }}</span>
        </span>
    </div>


    {{ if $playlist_data.description }}
    <p class="text-lg opacity-90 mb-4">{{ $playlist_data.description | safeHTML }}</p>

    {{ end }}
    <iframe style="border-radius:12px" src="{{ replace $playlist_data.url "playlist" "embed/playlist" }}?utm_source=generator" width="100%" height="400" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy">
    </iframe>


    <div class="flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between py-4">
        <div class="flex items-center space-x-4">
            <div class="relative">

                <input type="text" id="playlist-search" placeholder="{{ i18n "playlists.search_placeholder" | default "Search tracks..." }}"
                       class="px-4 py-2 border border-neutral-300 dark:border-neutral-600 rounded-lg bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:ring-2 focus:ring-primary-500 focus:border-transparent">

            </div>
            <select id="sort-select" class="ml-2 px-3 py-2 border border-neutral-300 dark:border-neutral-600 rounded-lg bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                <option value="default">{{ i18n "playlists.sort_default" | default "Default Order" }}</option>
                <option value="title">{{ i18n "playlists.sort_title" | default "Title" }}</option>
                <option value="artist">{{ i18n "playlists.sort_artist" | default "Artist" }}</option>
                <option value="album">{{ i18n "playlists.sort_album" | default "Album" }}</option>
                <option value="duration">{{ i18n "playlists.sort_duration" | default "Duration" }}</option>
            </select>
        </div>
        <div class="flex items-center space-x-2">
            <span id="track-count" class="text-sm text-neutral-600 dark:text-neutral-400">
                {{ len $playlist_data.tracks }} {{ i18n "playlists.tracks_showing" | default "tracks" }}
            </span>
            <button id="reset-sort" class="text-sm text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-200">
                {{ i18n "playlists.reset" | default "Reset" }}
            </button>
        </div>
    </div>

    <div class="bg-white dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-700 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-neutral-50 dark:bg-neutral-700">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase tracking-wider cursor-pointer hover:bg-neutral-100 dark:hover:bg-neutral-600" data-sort="title">
                            {{ i18n "playlists.title" | default "Title" }}
                            <svg class="inline w-3 h-3 ml-1 sort-icon" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase tracking-wider cursor-pointer hover:bg-neutral-100 dark:hover:bg-neutral-600" data-sort="artist">
                            {{ i18n "playlists.artist" | default "Artist" }}
                            <svg class="inline w-3 h-3 ml-1 sort-icon" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase tracking-wider cursor-pointer hover:bg-neutral-100 dark:hover:bg-neutral-600" data-sort="album">
                            {{ i18n "playlists.album" | default "Album" }}
                            <svg class="inline w-3 h-3 ml-1 sort-icon" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                        </th>
                        <th class="px-3 py-3 text-right text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase tracking-wider cursor-pointer hover:bg-neutral-100 dark:hover:bg-neutral-600 w-28" data-sort="duration">
                            {{ i18n "playlists.duration" | default "Time" }}
                            <svg class="inline w-3 h-3 ml-1 sort-icon" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                        </th>
                    </tr>
                </thead>
                <tbody id="tracks-tbody" class="bg-white dark:bg-neutral-800 divide-y divide-neutral-200 dark:divide-neutral-700">
                    {{ range $index, $track := $playlist_data.tracks }}
                    {{ $track_duration_seconds := div .duration_ms 1000 }}
                    {{ $minutes := div $track_duration_seconds 60 | int }}
                    {{ $seconds := mod $track_duration_seconds 60 | int }}
                                         <tr class="track-row hover:bg-neutral-50 dark:hover:bg-neutral-700"
                         data-title="{{ .name | lower }}"
                         data-artist="{{ index .artists 0 | lower }}"
                         data-album="{{ .album | lower }}"
                         data-duration="{{ .duration_ms }}">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-neutral-900 dark:text-neutral-100">{{ .name }}</div>
                        </td>
                                                 <td class="px-6 py-4 whitespace-nowrap">
                             <div class="text-sm text-neutral-900 dark:text-neutral-100">{{ index .artists 0 }}</div>
                         </td>
                         <td class="px-6 py-4 whitespace-nowrap">
                             <div class="text-sm text-neutral-900 dark:text-neutral-100">{{ .album }}</div>
                         </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral-500 dark:text-neutral-400 text-right">
                            {{ printf "%d:%02d" $minutes $seconds }}
                        </td>
                    </tr>
                    {{ end }}
                </tbody>
            </table>
        </div>
    </div>
    */}}

    <!-- No Results Message -->
    <div id="no-results" class="hidden text-center py-12">
        <svg class="mx-auto h-12 w-12 text-neutral-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.47-.881-6.08-2.33"/>
        </svg>
        <h3 class="mt-2 text-sm font-medium text-neutral-900 dark:text-neutral-100">
            {{ i18n "playlists.no_results" | default "No tracks found" }}
        </h3>
        <p class="mt-1 text-sm text-neutral-500 dark:text-neutral-400">
            {{ i18n "playlists.no_results_description" | default "Try adjusting your search terms." }}
        </p>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const table = document.querySelector('table');
    const tbody = document.getElementById('tracks-tbody');
    const searchInput = document.getElementById('playlist-search');
    const sortSelect = document.getElementById('sort-select');
    const resetButton = document.getElementById('reset-sort');
    const trackCount = document.getElementById('track-count');
    const noResults = document.getElementById('no-results');

    let originalRows = Array.from(tbody.querySelectorAll('tr'));
    let currentSort = { column: 'default', direction: 'asc' };

    // Search functionality
    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const rows = tbody.querySelectorAll('tr');
        let visibleCount = 0;

        rows.forEach(row => {
            const title = row.getAttribute('data-title');
            const artist = row.getAttribute('data-artist');
            const album = row.getAttribute('data-album');

            const matches = title.includes(searchTerm) ||
                           artist.includes(searchTerm) ||
                           album.includes(searchTerm);

            row.style.display = matches ? '' : 'none';
            if (matches) visibleCount++;
        });

        trackCount.textContent = `${visibleCount} ${visibleCount === 1 ? 'track' : 'tracks'}`;
        noResults.style.display = visibleCount === 0 ? 'block' : 'none';
    });

    // Sort functionality
    function sortTable(column, direction) {
        const rows = Array.from(tbody.querySelectorAll('tr'));

        rows.sort((a, b) => {
            let aValue, bValue;

            switch(column) {
                case 'title':
                    aValue = a.getAttribute('data-title');
                    bValue = b.getAttribute('data-title');
                    break;
                case 'artist':
                    aValue = a.getAttribute('data-artist');
                    bValue = b.getAttribute('data-artist');
                    break;
                case 'album':
                    aValue = a.getAttribute('data-album');
                    bValue = b.getAttribute('data-album');
                    break;
                case 'duration':
                    aValue = parseInt(a.getAttribute('data-duration'));
                    bValue = parseInt(b.getAttribute('data-duration'));
                    break;
                default:
                    return 0;
            }

            if (direction === 'asc') {
                return aValue > bValue ? 1 : -1;
            } else {
                return aValue < bValue ? 1 : -1;
            }
        });

        rows.forEach(row => tbody.appendChild(row));
    }

    // Sort select change
    sortSelect.addEventListener('change', function() {
        const column = this.value;
        if (column === 'default') {
            resetSort();
        } else {
            currentSort.column = column;
            currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            sortTable(column, currentSort.direction);
            updateSortIndicators();
        }
    });

    // Header click handlers for sorting
    const headers = table.querySelectorAll('th[data-sort]');
    headers.forEach(header => {
        header.addEventListener('click', function() {
            const column = this.getAttribute('data-sort');
            if (column === 'default') {
                resetSort();
            } else {
                if (currentSort.column === column) {
                    currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSort.column = column;
                    currentSort.direction = 'asc';
                }
                sortTable(column, currentSort.direction);
                updateSortIndicators();

                // Update the select dropdown to match
                sortSelect.value = column;
            }
        });
    });

    // Reset sort
    resetButton.addEventListener('click', resetSort);

    function resetSort() {
        const tbody = table.querySelector('tbody');
        originalRows.forEach(row => tbody.appendChild(row));
        currentSort = { column: 'default', direction: 'asc' };
        updateSortIndicators();
        sortSelect.value = 'default';
    }

    function updateSortIndicators() {
        const headers = table.querySelectorAll('th[data-sort]');
        headers.forEach(header => {
            const icon = header.querySelector('.sort-icon');
            if (header.getAttribute('data-sort') === currentSort.column) {
                icon.style.transform = currentSort.direction === 'asc' ? 'rotate(180deg)' : 'rotate(0deg)';
            } else {
                icon.style.transform = 'rotate(0deg)';
            }
        });
    }
});
</script>
{{ end }}
